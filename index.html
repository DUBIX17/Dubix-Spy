<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bluetooth Mic Recorder</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin-top: 50px;
}
button { margin: 10px; padding: 10px 20px; font-size: 16px; }
audio { margin-top: 20px; width: 80%; }
</style>
</head>
<body>

<h2>Bluetooth Mic Recorder</h2>
<p>Use your earbuds as the mic</p>

<button id="startBtn">Start Recording</button>
<button id="stopBtn" disabled>Stop Recording</button>
<a id="download" style="display:block; margin:10px 0;"></a>
<audio id="player" controls></audio>

<script>
let recorder;
let audioChunks = [];
let stream;

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const download = document.getElementById("download");
const player = document.getElementById("player");

startBtn.onclick = async () => {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);

    recorder.ondataavailable = e => audioChunks.push(e.data);
    recorder.start();

    startBtn.disabled = true;
    stopBtn.disabled = false;
    download.textContent = '';
    player.src = '';
    console.log("Recording started");
  } catch (err) {
    alert("Mic permission denied or unavailable: " + err);
  }
};

stopBtn.onclick = () => {
  recorder.stop();
  recorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: "audio/webm" });
    const url = URL.createObjectURL(blob);

    player.src = url;
    download.href = url;
    download.download = "recording.webm";
    download.textContent = "Download Recording";

    // Clear chunks for next recording
    audioChunks = [];

    // Stop all tracks
    stream.getTracks().forEach(track => track.stop());

    startBtn.disabled = false;
    stopBtn.disabled = true;
    console.log("Recording stopped");
  };
};
</script>

</body>
</html>
